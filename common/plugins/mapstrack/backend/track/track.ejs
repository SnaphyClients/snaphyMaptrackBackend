<!--
//////////////////////////////////////////////////////

DESIGNED & DEVELOPED by SNAPHY.COM

//////////////////////////////////////////////////////
-->
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MapsTrack &mdash; Finding event made easy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="Snaphy.com" />
    <![endif]-->
    <!-- endbuild -->
    <link rel="stylesheet"  href="/mapstrack/style/tracking.css">
</head>

<body>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyAjI6E3xT9SKO84W-0NL3zJCsx5eWrP1KU"></script>
<!--&lt;!&ndash;-><script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>-->
<div id="map-canvas"></div>


<script>
    // Initialize the Google Maps API v3
    var map = new google.maps.Map(document.getElementById('map-canvas'), {
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });


    var marker = null;

    function autoUpdate() {
        console.log("i am updating");
        navigator.geolocation.getCurrentPosition(function(position) {
            var currentLocation = new google.maps.LatLng(position.coords.latitude,
                    position.coords.longitude);

            var directionsService = new google.maps.DirectionsService;
            var directionsDisplay = new google.maps.DirectionsRenderer({
                        map: map
                    });

            if (marker) {
                // Marker already created - Move it
                marker.setPosition(currentLocation);
            }
            else {
                // Marker does not exist - Create it
                marker = new google.maps.Marker({
                    position: currentLocation,
                    map: map,
                    title: "Current Position"
                });
            }

            var destination = new google.maps.LatLng(51.7519, -1.2578);


            var destinationMarker = new google.maps.Marker({
                position: destination,
                title: "Event Name",
                label: "B",
                map: map
            });

            // Center the map on the new position
            map.setCenter(currentLocation);
            calculateAndDisplayRoute(directionsService, directionsDisplay, currentLocation, destinationMarker);
        });



        // Call the autoUpdate() function every 5 seconds
        setTimeout(autoUpdate, 5000);
    }

    //autoUpdate();
    var markerA = null;
    var markerB = null;
    function initMap() {
        var pointA = new google.maps.LatLng(51.7519, -1.2578),
                pointB = new google.maps.LatLng(50.8429, -0.1313),
                myOptions = {
                    zoom: 7,
                    center: pointA
                },
                map = new google.maps.Map(document.getElementById('map-canvas'), myOptions),
        // Instantiate a directions service.
                directionsService = new google.maps.DirectionsService,
                directionsDisplay = new google.maps.DirectionsRenderer({
                    map: map
                });

                if(markerA === null){
                    markerA = new google.maps.Marker({
                        position: pointA,
                        title: "point A",
                        label: "A",
                        map: map
                    });
                }else{
                    
                }


                if(markerB === null){
                    markerB = new google.maps.Marker({
                        position: pointB,
                        title: "point B",
                        label: "B",
                        map: map
                    });
                }


        // get route from A to B
        calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB);

    }



    function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB) {
        directionsService.route({
            origin: pointA,
            destination: pointB,
            travelMode: google.maps.TravelMode.DRIVING
        }, function(response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
            } else {
                window.alert('Directions request failed due to ' + status);
            }
        });
    }

    initMap();
</script>
</body>
</html>
